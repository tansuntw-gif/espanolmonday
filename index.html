<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¥¿èªå­¸ç¿’å¤§å¸« - å£èªªå¢å¼·ç‰ˆ</title>
    <style>
        :root { --primary: #007AFF; --secondary: #6c757d; --success: #34C759; --danger: #FF3B30; --voice: #5856D6; }
        body { font-family: -apple-system, sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .card { width: 90%; max-width: 450px; padding: 25px; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; }
        .menu-grid { display: grid; grid-template-columns: repeat(1, 1fr); gap: 10px; margin-top: 20px; max-height: 400px; overflow-y: auto; padding: 5px; }
        .lesson-btn { background: white; border: 2px solid var(--primary); color: var(--primary); padding: 15px; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.2s; text-align: left; }
        .lesson-btn:hover { background: var(--primary); color: white; }
        .quiz-container { display: none; }
        .stats-bar { display: flex; justify-content: space-between; font-size: 14px; color: #666; margin-bottom: 15px; }
        #chinese-text { font-size: 20px; font-weight: bold; margin: 20px 0; min-height: 50px; color: #333; line-height: 1.4; }
        input[type="text"] { width: 100%; padding: 15px; font-size: 18px; border: 2px solid #ddd; border-radius: 12px; margin-bottom: 15px; text-align: center; outline: none; box-sizing: border-box; }
        input[type="text"]:focus { border-color: var(--primary); }
        .ans-display { font-size: 18px; color: var(--primary); font-weight: bold; margin-bottom: 15px; display: none; background: #eef7ff; padding: 10px; border-radius: 10px; cursor: pointer; }
        button.action-btn { width: 100%; border: none; padding: 15px; border-radius: 12px; font-size: 18px; cursor: pointer; font-weight: bold; margin-bottom: 10px; transition: 0.3s; }
        .btn-check { background: var(--primary); color: white; }
        .btn-next { background: var(--secondary); color: white; }
        .btn-back { background: none; color: var(--secondary); font-size: 14px; text-decoration: underline; border: none; cursor: pointer; }
        #mic-btn.listening { background-color: var(--danger) !important; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="card" id="menu-screen">
    <h2 style="margin-top:0">é¸æ“‡èª²ç¨‹</h2>
    <p style="color:#666">ç¬¬ 5 èª²è‡³ç¬¬ 8 èª² (æ”¯æ´å£èªª)</p>
    <div class="menu-grid" id="lesson-menu"></div>
</div>

<div class="card quiz-container" id="quiz-screen">
    <div class="stats-bar">
        <div id="current-lesson-name">è¼‰å…¥ä¸­...</div>
        <div id="progress">0 / 0</div>
        <div id="score">å¾—åˆ†: 0</div>
    </div>
    <div id="chinese-text">é¡Œç›®è¼‰å…¥ä¸­...</div>
    
    <input type="text" id="user-input" placeholder="è«‹è¼¸å…¥æˆ–ç”¨èªªçš„..." autocomplete="off">
    
    <button id="mic-btn" class="action-btn" style="background-color: var(--voice); color: white;" onclick="startListening()">
        ğŸ¤ æŒ‰ä¸‹é–‹å§‹å£èªª
    </button>

    <div id="feedback" style="margin-bottom:10px; font-weight:bold;"></div>
    <div id="ans-display" class="ans-display" onclick="speakCurrent()"></div>
    
    <div class="btn-group">
        <button id="check-btn" class="action-btn btn-check" onclick="checkAnswer()">æª¢æŸ¥ç­”æ¡ˆ</button>
        <button class="action-btn btn-next" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ</button>
        <button class="btn-back" onclick="goToMenu()">å›ä¸»é¸å–®</button>
    </div>
</div>
    
<script>
    const allLessons = {
        "ç¬¬ 5 èª²ï¼šÂ¿DÃ³nde estÃ¡ la estaciÃ³n? (è»Šç«™åœ¨å“ªè£¡ï¼Ÿ)": [
            { ch: "ä¸å¥½æ„æ€ï¼Œæ™®æ‹‰å¤šåšç‰©é¤¨åœ¨å“ªè£¡ï¼Ÿ", sp: "Perdone, Â¿dÃ³nde estÃ¡ el museo del Prado?" },
            { ch: "é›¢é€™è£¡æœ‰ä¸€é»é ã€‚ä½ å¾—æ­åœ°éµã€‚", sp: "EstÃ¡ un poco lejos de aquÃ­. Tienes que coger el metro." },
            { ch: "åœ°éµç«™åœ¨å“ªè£¡ï¼Ÿé›¢é€™è£¡å¾ˆè¿‘ã€‚å°±åœ¨æ›¸å ±æ”¤å°é¢ã€‚", sp: "Â¿DÃ³nde estÃ¡ la station de metro? EstÃ¡ cerca de aquÃ­. EstÃ¡ enfrente del quiosco." },
            { ch: "éå¸¸æ„Ÿè¬ã€‚ / ä¸å®¢æ°£ã€‚", sp: "Muchas gracias. De nada." },
            { ch: "å—¨ï¼Œå®‰æ±å°¼å¥§ã€‚çœŸå·§ã€‚ä½ ä½åœ¨é€™é™„è¿‘å—ï¼Ÿ", sp: "Hola, Antonio. QuÃ© casualidad. Â¿Vives cerca de aquÃ­?" },
            { ch: "ä¸ï¼Œæˆ‘åœ¨é€™è£¡æ˜¯å› ç‚ºæˆ‘å’Œå¥³æœ‹å‹æœ‰ç´„ã€‚", sp: "No, estoy aquÃ­ porque tengo una cita con mi novia." },
            { ch: "ä½ ç¾åœ¨ä½åœ¨å“ªè£¡ï¼Ÿæˆ‘ä½åœ¨åˆç§Ÿå…¬å¯“ã€‚å…¬å¯“åœ¨ç´¢é‡Œäºè¡—ã€‚", sp: "Â¿DÃ³nde vives ahora? Vivo en un piso compartido. El piso estÃ¡ en la calle Zorrilla." },
            { ch: "æˆ‘ç­‹ç–²åŠ›ç«­ï¼Œå› ç‚ºæˆ‘æœ‰å¾ˆå¤šå·¥ä½œã€‚", sp: "Estoy agotado porque tengo mucho trabajo." },
            { ch: "ä½ ä¾†è‡ªå“ªè£¡ï¼Ÿæˆ‘ä¾†è‡ªé¦¬å¾·é‡Œã€‚", sp: "Â¿De dÃ³nde eres tÃº? Yo soy de Madrid." },
            { ch: "ä½ ä½åœ¨å“ªè£¡ï¼Ÿæˆ‘å’Œæœ‹å‹ä½åœ¨ä¸€é–“å…¬å¯“è£¡ã€‚", sp: "Â¿DÃ³nde vives? Vivo en un piso con mi amigo." },
            { ch: "å…¬å¯“åœ¨å“ªè£¡ï¼Ÿå…¬å¯“åœ¨ä¸€å®¶éºµåŒ…åº—å°é¢ã€‚", sp: "Â¿DÃ³nde estÃ¡ el piso? El piso estÃ¡ enfrente de una panaderÃ­a." },
            { ch: "éºµåŒ…åº—åœ¨å“ªè£¡ï¼Ÿå®ƒåœ¨æ•™å ‚å‰é¢ï¼Œå»£å ´å¾Œé¢ã€‚", sp: "Â¿DÃ³nde estÃ¡ la panaderÃ­a? EstÃ¡ delante de la iglesia y detrÃ¡s de la plaza." },
            { ch: "å…¬å¯“åœ¨å ±æ”¤æ—é‚Šå—ï¼Ÿå…¬å¯“å°±åœ¨é‚£è£¡ã€‚", sp: "Â¿EstÃ¡ el piso al lado de un quiosco? AllÃ­ estÃ¡ el piso." },
            { ch: "Elisaï¼Œå¦³ä¸ˆå¤«åœ¨å“ªè£¡ï¼Ÿä»–åœ¨æ³•åœ‹å‡ºå·®ã€‚", sp: "Elisa, Â¿dÃ³nde estÃ¡ tu marido? EstÃ¡ de viaje de negocios por Francia." },
            { ch: "æ˜å¤©ä»–åœ¨å·´é»æœ‰ä¸€å€‹æœƒè­°ã€‚", sp: "MaÃ±ana tiene una reuniÃ³n en ParÃ­s." },
            { ch: "ä½ å€‘ç¾åœ¨ä½åœ¨é¦¬å¾·é‡Œå—ï¼Ÿä¸ï¼Œæˆ‘å€‘åœ¨è–©æ‹‰æ›¼å¡è²·äº†ä¸€æ£Ÿåˆ¥å¢…ã€‚", sp: "Â¿VivÃ­s en Madrid ahora? No, mi marido y yo compramos un chalÃ© en Salamanca." },
            { ch: "é›¢å¸‚ä¸­å¿ƒæœ‰é»é ï¼Œä½†åœ¨ä¸€å€‹éå¸¸å®‰éœçš„å€åŸŸã€‚", sp: "EstÃ¡ un poco lejos del centro, pero estÃ¡ en una zona muy tranquila." },
            { ch: "æ‰‹æ©Ÿåœ¨å“ªè£¡ï¼Ÿæ‰‹æ©Ÿåœ¨æ¡Œå­ä¸Šã€‚", sp: "Â¿DÃ³nde estÃ¡ el mÃ³vil? El mÃ³vil estÃ¡ encima de la mesa." },
            { ch: "ä½ çˆ¶è¦ªåœ¨å“ªè£¡å·¥ä½œï¼Ÿæˆ‘çˆ¶è¦ªåœ¨ä¸€æ‰€å­¸æ ¡å·¥ä½œã€‚", sp: "Â¿DÃ³nde trabaja tu padre? Mi padre trabaja en una school." }
        ],
        "ç¬¬ 6 èª²ï¼šHay comedor en la facultad (å­¸é™¢è£¡æœ‰é£Ÿå ‚)": [
            { ch: "ä½ çŸ¥é“åœ–æ›¸é¤¨åœ¨å“ªè£¡å—ï¼Ÿå°±åœ¨å½±å°åº—æ—é‚Šã€‚", sp: "Â¿Sabes dÃ³nde estÃ¡ la biblioteca? EstÃ¡ ahÃ­, al lado de la tienda de fotocopias." },
            { ch: "å­¸é™¢è£¡æœ‰é£Ÿå ‚æˆ–å’–å•¡å»³å—ï¼Ÿ", sp: "Â¿Hay un comedor o una cafeterÃ­a en la facultad?" },
            { ch: "æ˜¯çš„ï¼Œé€™ä¸€å±¤æœ‰ä¸€é–“å’–å•¡å»³å’Œä¸€å€‹é£Ÿå ‚ã€‚", sp: "SÃ­, hay una cafeterÃ­a and un comedor en esta planta." },
            { ch: "ä¸€æ¨“æœ‰ä»€éº¼ï¼Ÿæœ‰ä¸€äº›æ•™å®¤ï¼Œç§˜æ›¸è™•ä¹Ÿåœ¨é‚£è£¡ã€‚", sp: "Â¿QuÃ© hay en la primera planta? Hay unas aulas y la SecretarÃ­a estÃ¡ allÃ­ tambiÃ©n." },
            { ch: "æˆ‘æ˜ç™½äº†ã€‚éå¸¸æ„Ÿè¬ã€‚", sp: "Ya veo. Muchas gracias." },
            { ch: "è£œç¿’ç­è£¡æœ‰å¤šå°‘é–“æ•™å®¤ï¼Ÿè£œç¿’ç­è£¡æœ‰ 10 é–“æ•™å®¤ã€‚", sp: "Â¿CuÃ¡ntas aulas hay en la academia? Hay diez aulas en la academia." },
            { ch: "è£œç¿’ç­è£¡æœ‰å¤šå°‘å­¸ç”Ÿï¼Ÿå¤§ç´„æœ‰ 75 åå­¸ç”Ÿã€‚", sp: "Hay unos setenta y cinco alumnos en nuestra academia." },
            { ch: "å“¥é›…è¡—æœ‰ä¸€é–“å’–å•¡å»³ã€‚åœ¨è¶…å¸‚æ—é‚Šã€‚", sp: "Hay una cafeterÃ­a en la calle Goya. La cafeterÃ­a estÃ¡ al lado del supermercado." },
            { ch: "å·´å‹ƒç¾…æ˜¯ä¸€ä½è¦ªåˆ‡çš„è€å¸«ã€‚", sp: "Pablo es un profesor amable." },
            { ch: "æˆ‘ç­ä¸Šå¤§ç´„æœ‰ 30 åå­¸ç”Ÿã€‚", sp: "Hay unos treinta estudiantes en mi clase." },
            { ch: "è¥¿ç­ç‰™äººå¾ˆè¦ªåˆ‡ã€‚", sp: "Los espaÃ±oles son amables." },
            { ch: "ç‹—åœ¨é€™è£¡ã€‚è²“åœ¨é‚£è£¡ã€‚èƒŒåŒ…åœ¨é‚£è£¡ï¼ˆé è™•ï¼‰ã€‚", sp: "El perro estÃ¡ aquÃ­. El gato estÃ¡ ahÃ­. La mochila estÃ¡ allÃ­." },
            { ch: "æ•™å®¤åœ¨å“ªè£¡ï¼Ÿåœ¨èµ°å»Šç›¡é ­ã€‚", sp: "Â¿DÃ³nde estÃ¡ el aula? EstÃ¡ al final del pasillo." },
            { ch: "æ•™å®¤è£¡æœ‰ä¸€å¡Šé»‘æ¿å’Œä¸€äº›æ¡Œå­ã€‚æœ‰æŠ•å½±æ©Ÿå—ï¼Ÿ", sp: "Hay una pizarra y unas mesas en el aula. Â¿Hay un proyector allÃ­?" },
            { ch: "ä¸ï¼Œæ²’æœ‰æŠ•å½±æ©Ÿã€‚", sp: "No, no hay proyector." },
            { ch: "ä½ ç¾åœ¨ä½åœ¨å“ªè£¡ï¼Ÿæˆ‘ä½åœ¨é™„è¿‘çš„ä¸€é–“å…¬å¯“ã€‚", sp: "Â¿DÃ³nde vives ahora? Vivo en un piso por aquÃ­ cerca." },
            { ch: "æˆ‘æœ‰å…©å€‹å®¤å‹ã€‚æˆ‘ä½åœ¨äºŒæ¨“ï¼ˆè¥¿ç­ç‰™ä¸€æ¨“ï¼‰ã€‚", sp: "Tengo dos compaÃ±eras de piso. Vivo en la primera planta." },
            { ch: "æ˜¯ä¸€é–“é™„å®¶å…·çš„å…¬å¯“å—ï¼Ÿæ˜¯çš„ã€‚", sp: "Â¿Es un piso amueblado? SÃ­." }
        ],
        "ç¬¬ 7 èª²ï¼šEllos son mis padres (ä»–å€‘æ˜¯æˆ‘çš„çˆ¶æ¯)": [
            { ch: "å¹´é•·çš„æ˜¯æˆ‘çš„ç¥–çˆ¶æ¯ã€‚ä»–å€‘æ˜¯èª°ï¼Ÿ", sp: "Los mayores son mis abuelos. Â¿QuiÃ©nes son?" },
            { ch: "ä»–å€‘æ˜¯æˆ‘çš„çˆ¶æ¯ï¼Œé‚£é‚Šé‚£äº›æ˜¯æˆ‘çš„å”ä¼¯èˆ…å§¨ã€‚", sp: "Ellos son mis padres y aquellos son mis tÃ­os." },
            { ch: "ä½ æœ‰å…„å¼Ÿå§Šå¦¹å—ï¼Ÿæœ‰ã€‚é€™æ˜¯æˆ‘çš„å“¥å“¥ï¼Œé€™æ˜¯æˆ‘çš„å¦¹å¦¹ã€‚", sp: "Â¿Tienes hermanos? SÃ­. Este es mi hermano mayor y esta es mi hermana menor." },
            { ch: "ä½ å¥½ï¼ŒAnaã€‚é€™ä½æ˜¯ Davidï¼Œæˆ‘çš„ä¸ˆå¤«ã€‚", sp: "Hola, Ana. Este es David, mi marido." },
            { ch: "é‚£å€‹ç”·å­©æ˜¯å¦³å…’å­ï¼Œä»–å¾ˆé«˜ã€‚æ˜¯çš„ï¼Œä»–å« Miguelï¼Œäº”æ­²ï¼Œå¾ˆèª¿çš®ã€‚", sp: "Aquel chico es tu hijo. Es muy alto. SÃ­, se llama Miguel. Tiene cinco aÃ±os y es travieso." },
            { ch: "Alberto å››æ­²ï¼Œå’Œå¦³å…’å­ä¸€æ¨£èª¿çš®ã€‚ä½† Alberto æ¯” Miguel çŸ®ã€‚", sp: "Alberto tiene cuatro aÃ±os y es tan travieso como tu hijo. Pero Alberto es mÃ¡s bajo que Miguel." },
            { ch: "é‚£é‚Šé‚£äº›ç”·å­©æ˜¯æˆ‘çš„åŒäº‹ã€‚é‚£å€‹å¥³å­©æ˜¯æˆ‘å¦¹å¦¹ã€‚", sp: "Aquellos chicos son mis compaÃ±eros. Esa chica es mi hermana menor." },
            { ch: "é€™ä½æ˜¯æˆ‘å…„å¼Ÿã€‚é€™æ˜¯æˆ‘å§Šå¦¹ã€‚", sp: "Este es mi hermano. Esta es mi hermana." },
            { ch: "Felisa æ¯” Elisa æ¼‚äº®ã€‚JosÃ© æ²’æœ‰ Enrique é‚£éº¼å¸¥ã€‚", sp: "Felisa es mÃ¡s guapa que Elisa. JosÃ© es menos guapo que Enrique." },
            { ch: "Luisa å’Œ LucÃ­a ä¸€æ¨£æ¼‚äº®ã€‚", sp: "Luisa es tan guapa como LucÃ­a." },
            { ch: "Felisa èªªè©±æ¯” Elisa å¤šã€‚JosÃ© åƒå¾—æ¯” Enrique å°‘ã€‚", sp: "Felisa habla mÃ¡s que Elisa. JosÃ© come menos que Enrique." },
            { ch: "æˆ‘æ“æœ‰çš„æ›¸æ¯” Pedro å¤š / å°‘ / ä¸€æ¨£å¤šã€‚", sp: "Yo tengo mÃ¡s libros que Pedro. / Yo tengo menos libros que Pedro. / Yo tengo tantos libros como Pedro." },
            { ch: "å“¥å“¥/å§Šå§Šã€‚å¼Ÿå¼Ÿ/å¦¹å¦¹ã€‚", sp: "Hermano mayor. Hermano menor." },
            { ch: "Antonio æ¯”æˆ‘å¤§ã€‚æˆ‘æ¯” Antonio å°ã€‚", sp: "Antonio es mayor que yo. Yo soy menor que Antonio." },
            { ch: "é€™å¹…ç•«æ¯”é‚£å¹…å¥½ã€‚é€™æœ¬æ›¸æ¯”é‚£æœ¬å·®ã€‚", sp: "Este cuadro es mejor que aquel. Este libro es peor que aquel." },
            { ch: "é‚£å€‹é«˜å€‹å­ç”·äººæ˜¯èª°ï¼Ÿæ˜¯æˆ‘å ‚å…„å¼Ÿã€‚åœ¨ä»–å³é‚Šçš„æ˜¯æˆ‘å”å”ã€‚", sp: "Â¿QuiÃ©n es el hombre alto? Es mi primo. A la derecha de mi primo estÃ¡ mi tÃ­o." },
            { ch: "é‚£äº›å¥³äººæ˜¯èª°ï¼Ÿ", sp: "Â¿QuiÃ©nes son las mujeres?" },
            { ch: "é‚£ä½å¹´é•·çš„å¥³æ€§æ˜¯æˆ‘å¬¸å¬¸ã€‚å¥¹åœ¨æˆ‘çš„å ‚å§Šå¦¹å·¦é‚Šã€‚", sp: "La mujer mayor es mi tÃ­a. EstÃ¡ a la izquierda de mi prima." },
            { ch: "ä½ æœ‰å¹¾å€‹å…„å¼Ÿå§Šå¦¹ï¼Ÿ", sp: "Â¿CuÃ¡ntos hermanos tienes?" },
            { ch: "ä½ å“¥å“¥çµå©šäº†å—ï¼Ÿæ˜¯çš„ï¼Œä»–çµå©šäº†ï¼Œæœ‰ä¸€å€‹å…’å­ã€‚ä»–å€‘ä½åœ¨é€™é™„è¿‘ã€‚", sp: "Â¿EstÃ¡ casado tu hermano mayor? SÃ­, estÃ¡ casado y tiene un hijo. Viven cerca de aquÃ­." },
            { ch: "é‚£å¦³å¦¹å¦¹å‘¢ï¼Ÿå¥¹å–®èº«ï¼Œä½†æœ‰ç”·æœ‹å‹ã€‚", sp: "Â¿Y tu hermana menor? EstÃ¡ soltera, pero tiene novio." }
        ],
        "ç¬¬ 8 èª²ï¼šÂ¿Sabes cÃ³mo llegar allÃ­? (ä½ çŸ¥é“æ€éº¼å»é‚£è£¡å—ï¼Ÿ)": [
            { ch: "é€™é€±æœ«æˆ‘å€‘å» La Alberca æ€éº¼æ¨£ï¼Ÿé‚£æ˜¯å€‹é™„è¿‘çš„æ‘èŠã€‚", sp: "Â¿QuÃ© tal si vamos a La Alberca este fin de semana? Es un pueblo cercano." },
            { ch: "å¥½ä¸»æ„ã€‚ä½ çŸ¥é“æ€éº¼å»é‚£è£¡ä»¥åŠæˆ‘å€‘ä½å“ªè£¡å—ï¼Ÿ", sp: "Buena idea. Â¿Sabes cÃ³mo llegar allÃ­ y dÃ³nde nos alojamos?" },
            { ch: "æˆ‘ä¸æ€éº¼äº†è§£é‚£å€‹æ‘èŠï¼Œä½†æˆ‘å€‘å¯ä»¥ä¸Šç¶²æœå°‹ã€‚", sp: "No conozco muy bien ese pueblo, pero podemos buscar por internet." },
            { ch: "ä½ çŸ¥é“å“ªè£¡å¯ä»¥ç§Ÿè»Šå—ï¼Ÿæ˜¯çš„ï¼Œæˆ‘èªè­˜é€™é™„è¿‘çš„ä¸€å®¶ç§Ÿè»Šåº—ã€‚", sp: "Â¿Sabes dÃ³nde podemos alquilar un coche? SÃ­, conozco un alquiler de coches cerca de aquÃ­." },
            { ch: "ä½ èªè­˜é‚£å€‹å¥³äººå—ï¼Ÿæ˜¯çš„ï¼Œå¥¹æ˜¯ Emiliaï¼ŒEnrique çš„å¥³æœ‹å‹ã€‚", sp: "Â¿Conoces a esa mujer? SÃ­, es Emilia, la novia de Enrique." },
            { ch: "å¥¹æ˜¯å°ç£äººï¼Œä½†å¥¹è¥¿ç­ç‰™æ–‡å’Œæ³•æ–‡éƒ½èªªå¾—å¾ˆå¥½ã€‚", sp: "Es taiwanesa, pero sabe muy bien espaÃ±ol y francÃ©s." },
            { ch: "å¥¹å’Œ Enrique æ˜¯è¾¦å…¬å®¤åŒäº‹ã€‚", sp: "Enrique y ella son compaÃ±eros de oficina." },
            { ch: "ä½ çŸ¥é“ Enrique æœ‰å€‹å¥³å…’å—ï¼Ÿæˆ‘ä¸çŸ¥é“ã€‚", sp: "Â¿Sabes que Enrique tiene una hija? No lo sÃ©." },
            { ch: "æˆ‘ä¸çŸ¥é“è»Šç«™åœ¨å“ªè£¡ã€‚", sp: "No sÃ© dÃ³nde estÃ¡ la estaciÃ³n." },
            { ch: "ä½ çŸ¥é“æ€éº¼ä½¿ç”¨é€™å°ç›¸æ©Ÿå—ï¼ŸæŠ±æ­‰ï¼Œæˆ‘ä¸çŸ¥é“ã€‚", sp: "Â¿Sabes cÃ³mo usar la cÃ¡mara? Lo siento, no lo sÃ©." },
            { ch: "Alicia çš„è¥¿ç­ç‰™æ–‡éå¸¸å¥½ã€‚Elisa ä¸€é»éƒ½ä¸æ‡‚ã€‚", sp: "Alicia sabe muy bien espaÃ±ol. Elisa no sabe nada de espaÃ±ol." },
            { ch: "MarÃ­a éå¸¸äº†è§£å°å—ã€‚ä½ èªè­˜ Emilia å—ï¼Ÿ", sp: "MarÃ­a conoce muy bien Tainan. Â¿Conoces a Emilia?" },
            { ch: "æˆ‘ä¸èƒ½å”±æ­Œï¼Œå› ç‚ºæˆ‘æ„Ÿå†’äº†ã€‚", sp: "No puedo cantar porque estoy resfriado." },
            { ch: "ä½ å¯ä»¥ä¾†æ©Ÿå ´æ¥æˆ‘å—ï¼Ÿ", sp: "Â¿Puedes recogerme en el aeropuerto?" },
            { ch: "æˆ‘å…„å¼Ÿæœƒè¸¢è¶³çƒã€‚", sp: "Mi hermano sabe jugar al fÃºtbol." },
            { ch: "ä½ å°é€™å€‹æ‘èŠç†Ÿæ‚‰å—ï¼Ÿæœ‰ä¸€é»ã€‚", sp: "Â¿Conoces bien este pueblo? Un poco." },
            { ch: "ä½ çŸ¥é“å“ªè£¡å¯ä»¥é‡é¤å—ï¼Ÿæˆ‘èªè­˜é€™é™„è¿‘çš„ä¸€å€‹å…¬åœ’ã€‚", sp: "Â¿Sabes dÃ³nde puedo hacer picnic? Conozco un parque cerca de aquÃ­." },
            { ch: "é‚£å“ªè£¡å¯ä»¥å–å’–å•¡ï¼Ÿæˆ‘ä¸çŸ¥é“ï¼Œä½†æˆ‘å€‘å¯ä»¥ä¸Šç¶²æ‰¾ã€‚", sp: "Â¿Y dÃ³nde puedo tomar cafÃ©? No lo sÃ©, pero podemos buscar por internet." },
            { ch: "å’Œ Eva åŠ Enrique ä¸€èµ·å»éœ²ç‡Ÿæ€éº¼æ¨£ï¼Ÿå¥½ä¸»æ„ã€‚", sp: "Â¿QuÃ© tal si vamos de camping con Eva y Enrique? Buena idea." },
            { ch: "æˆ‘å€‘å¯ä»¥åœ¨é‚£è£¡çƒ¤è‚‰å’Œåšè¥¿ç­ç‰™å¤§é‹é£¯ã€‚", sp: "Podemos hacer barbacoa y paella allÃ­." },
            { ch: "ä½ æœƒåšå¤§é‹é£¯å—ï¼Ÿç•¶ç„¶ã€‚æ­¤å¤–ï¼Œæˆ‘é‚„è¦åšæ°´æœé…’å’Œé–‹èƒƒèœã€‚", sp: "Â¿Sabes cÃ³mo hacer paella? Por supuesto. AdemÃ¡s, voy a hacer sangrÃ­a y tapas." }
        ]
    };

let currentQuestions = [];
    let currentIndex = 0;
    let currentScore = 0;

    // --- èªéŸ³è¾¨è­˜é‚è¼¯ ---
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition;

    if (SpeechRecognition) {
        recognition = new SpeechRecognition();
        recognition.lang = 'es-ES'; // è¥¿ç­ç‰™å£éŸ³
        recognition.interimResults = false;

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            document.getElementById('user-input').value = transcript;
            checkAnswer(); // è¾¨è­˜å®Œè‡ªå‹•æª¢æŸ¥
        };

        recognition.onend = () => {
            const btn = document.getElementById('mic-btn');
            btn.classList.remove('listening');
            btn.innerText = "ğŸ¤ æŒ‰ä¸‹é–‹å§‹å£èªª";
        };

        recognition.onerror = () => {
            alert("å£èªªè¾¨è­˜å‡ºéŒ¯ï¼Œè«‹æª¢æŸ¥æ¬Šé™æˆ–ç¶²è·¯ã€‚");
        };
    }

    function startListening() {
        if (!recognition) return alert("æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´å£èªªè¾¨è­˜");
        recognition.start();
        const btn = document.getElementById('mic-btn');
        btn.classList.add('listening');
        btn.innerText = "æ­£åœ¨è½...è«‹èªªè¥¿æ–‡";
    }

    // --- åŸºç¤åŠŸèƒ½é‚è¼¯ (Menu, Show, Check, Next, Speak) ---
    function initMenu() {
        const menu = document.getElementById('lesson-menu');
        menu.innerHTML = "";
        Object.keys(allLessons).forEach(name => {
            const btn = document.createElement('button');
            btn.className = 'lesson-btn';
            btn.innerText = name;
            btn.onclick = () => startLesson(name);
            menu.appendChild(btn);
        });
    }

    function startLesson(name) {
        currentQuestions = [...allLessons[name]].sort(() => Math.random() - 0.5);
        currentIndex = 0;
        currentScore = 0;
        document.getElementById('menu-screen').style.display = 'none';
        document.getElementById('quiz-screen').style.display = 'block';
        document.getElementById('current-lesson-name').innerText = name;
        showQuestion();
    }

    function showQuestion() {
        const q = currentQuestions[currentIndex];
        document.getElementById('chinese-text').innerText = q.ch;
        const userInput = document.getElementById('user-input');
        userInput.value = "";
        userInput.style.borderColor = "#ddd";
        document.getElementById('feedback').innerText = "";
        document.getElementById('ans-display').style.display = "none";
        document.getElementById('progress').innerText = `${currentIndex + 1} / ${currentQuestions.length}`;
        document.getElementById('score').innerText = `å¾—åˆ†: ${currentScore}`;
        userInput.focus();
    }

    function checkAnswer() {
        const userInput = document.getElementById('user-input');
        const userValue = userInput.value.trim();
        const correctAnswer = currentQuestions[currentIndex].sp;
        const userClean = userValue.toLowerCase().replace(/[Â¿?.,!]/g, "").normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        const correctClean = correctAnswer.toLowerCase().replace(/[Â¿?.,!]/g, "").normalize("NFD").replace(/[\u0300-\u036f]/g, "");

        const feedback = document.getElementById('feedback');
        const ansDisp = document.getElementById('ans-display');

        if (userClean === correctClean) {
            currentScore += 10;
            feedback.innerText = "Â¡Muy bien! æ­£ç¢ºï¼";
            feedback.style.color = "var(--success)";
            ansDisp.innerHTML = correctAnswer + " ğŸ”Š";
            ansDisp.style.display = "block";
            userInput.style.borderColor = "var(--success)";
            speak(correctAnswer);
        } else {
            feedback.innerText = "å†è©¦ä¸€æ¬¡ï¼";
            feedback.style.color = "var(--danger)";
            userInput.style.borderColor = "var(--danger)";
        }
    }

    function nextQuestion() {
        if (currentIndex < currentQuestions.length - 1) {
            currentIndex++;
            showQuestion();
        } else {
            alert("èª²ç¨‹çµæŸï¼");
            goToMenu();
        }
    }

    function goToMenu() {
        document.getElementById('menu-screen').style.display = 'block';
        document.getElementById('quiz-screen').style.display = 'none';
    }

    function speak(text) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'es-ES';
        window.speechSynthesis.speak(utterance);
    }
    
    function speakCurrent() {
        speak(currentQuestions[currentIndex].sp);
    }

    initMenu();
</script>
</body>
</html>









